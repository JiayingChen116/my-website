---
categories:
- ""
- ""
date: "2017-10-31T22:26:09-05:00"
description: Lorem Etiam Nullam
draft: false
image: pic09.jpg
keywords: ""
slug: magna
title: Magna
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<hr />
<p>Our added answers/comments are always in italic!</p>
<hr />
<div id="where-do-people-drink-the-most-beer-wine-and-spirits" class="section level1">
<h1>Where Do People Drink The Most Beer, Wine And Spirits?</h1>
<pre class="r"><code>library(fivethirtyeight)
data(drinks)


# or download directly
alcohol_direct &lt;- read_csv(&quot;https://raw.githubusercontent.com/fivethirtyeight/data/master/alcohol-consumption/drinks.csv&quot;)</code></pre>
<ul>
<li>What are the variable types? Any missing values we should worry about?</li>
</ul>
<pre class="r"><code>skim(alcohol_direct)</code></pre>
<table>
<caption>(#tab:glimpse_skim_data)Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">alcohol_direct</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">193</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">4</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">country</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">28</td>
<td align="right">0</td>
<td align="right">193</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beer_servings</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">106.16</td>
<td align="right">101.14</td>
<td align="right">0</td>
<td align="right">20.0</td>
<td align="right">76.0</td>
<td align="right">188.0</td>
<td align="right">376.0</td>
<td align="left">▇▃▂▂▁</td>
</tr>
<tr class="even">
<td align="left">spirit_servings</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">80.99</td>
<td align="right">88.28</td>
<td align="right">0</td>
<td align="right">4.0</td>
<td align="right">56.0</td>
<td align="right">128.0</td>
<td align="right">438.0</td>
<td align="left">▇▃▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">wine_servings</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">49.45</td>
<td align="right">79.70</td>
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">8.0</td>
<td align="right">59.0</td>
<td align="right">370.0</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">total_litres_of_pure_alcohol</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.72</td>
<td align="right">3.77</td>
<td align="right">0</td>
<td align="right">1.3</td>
<td align="right">4.2</td>
<td align="right">7.2</td>
<td align="right">14.4</td>
<td align="left">▇▃▅▃▁</td>
</tr>
</tbody>
</table>
<p><em>As the report on <code>n_missing</code> in the above output shows, there don’t seem to be any missing values for any variable in the data set. Moreover, we can observe that the only non-numeric variable is <code>country</code>, while the four remaining are numeric.</em></p>
<hr />
<ul>
<li>Make a plot that shows the top 25 beer consuming countries</li>
</ul>
<pre class="r"><code># YOUR CODE GOES HERE
beer_consumtion &lt;- alcohol_direct %&gt;%
  slice_max(order_by = beer_servings, n = 25)

ggplot(beer_consumtion, aes(y=fct_reorder(country,beer_servings), x=beer_servings))+
  geom_col(fill = &quot;orange&quot;)+
  theme_bw(  )+
  labs(title = &quot;Beer Consumption&quot;, subtitle = &quot;The top beer consuming countries&quot;, x=&quot;Annual Servings&quot;, y=&quot;Country&quot;)</code></pre>
<p><img src="/blogs/hw1_files/figure-html/beer_plot-1.png" width="648" style="display: block; margin: auto;" /></p>
<ul>
<li>Make a plot that shows the top 25 wine consuming countries</li>
</ul>
<pre class="r"><code>wine_consumption &lt;- alcohol_direct %&gt;%
  slice_max(order_by = wine_servings, n = 25)

ggplot(wine_consumption, aes(y=fct_reorder(country,wine_servings), x=wine_servings))+
  geom_col(fill = &quot;darkred&quot;)+
  theme_bw(  )+
  labs(title = &quot;Wine Consumption&quot;, subtitle = &quot;The top wine consuming countries&quot;, x=&quot;Annual Servings&quot;, y=&quot;Country&quot;)</code></pre>
<p><img src="/blogs/hw1_files/figure-html/wine_plot-1.png" width="648" style="display: block; margin: auto;" /></p>
<ul>
<li>Finally, make a plot that shows the top 25 spirit consuming countries</li>
</ul>
<pre class="r"><code># YOUR CODE GOES HERE
spirit_consumtion &lt;- alcohol_direct %&gt;%
  slice_max(order_by = spirit_servings, n = 25)

ggplot(spirit_consumtion, aes(y=fct_reorder(country,spirit_servings), x=spirit_servings))+
  geom_col(fill = &quot;lightblue&quot;)+
  theme_bw(  )+
  labs(title = &quot;Spirit Consumption&quot;, subtitle = &quot;The top spirit consuming countries&quot;, x=&quot;Annual Servings&quot;, y=&quot;Country&quot;)</code></pre>
<p><img src="/blogs/hw1_files/figure-html/spirit_plot-1.png" width="648" style="display: block; margin: auto;" /></p>
<ul>
<li>What can you infer from these plots? Don’t just explain what’s in the graph, but speculate or tell a short story (1-2 paragraphs max).</li>
</ul>
<p><em>In general, there tends to be no overlap among countries with regards to the top spots in alcohol consumption, i.e. the top beer consuming countries are not the top wine consuming countries. It is surprising that Germany is only ranked #4 in the top beer consuming countries, after Namibia, Czech Republic and Gabon. A quick research on the reason for Namibia’s high beer consumption hint at its former colonial ties with Germany (see <a href="https://worldpopulationreview.com/country-rankings/beer-consumption-by-country">here</a>). Also, one can observe that the top wine consuming countries are almost exclusively European, which might be due to the reason that wine is culturally rooted in these countries and many of them are also known for their production of wine.</em></p>
<hr />
</div>
<div id="analysis-of-movies--imdb-dataset" class="section level1">
<h1>Analysis of movies- IMDB dataset</h1>
<pre class="r"><code>movies &lt;- read_csv(here::here(&quot;data&quot;, &quot;movies.csv&quot;))
glimpse(movies)</code></pre>
<pre><code>## Rows: 2,961
## Columns: 11
## $ title               &lt;chr&gt; &quot;Avatar&quot;, &quot;Titanic&quot;, &quot;Jurassic World&quot;, &quot;The Avenge…
## $ genre               &lt;chr&gt; &quot;Action&quot;, &quot;Drama&quot;, &quot;Action&quot;, &quot;Action&quot;, &quot;Action&quot;, &quot;…
## $ director            &lt;chr&gt; &quot;James Cameron&quot;, &quot;James Cameron&quot;, &quot;Colin Trevorrow…
## $ year                &lt;dbl&gt; 2009, 1997, 2015, 2012, 2008, 1999, 1977, 2015, 20…
## $ duration            &lt;dbl&gt; 178, 194, 124, 173, 152, 136, 125, 141, 164, 93, 1…
## $ gross               &lt;dbl&gt; 7.61e+08, 6.59e+08, 6.52e+08, 6.23e+08, 5.33e+08, …
## $ budget              &lt;dbl&gt; 2.37e+08, 2.00e+08, 1.50e+08, 2.20e+08, 1.85e+08, …
## $ cast_facebook_likes &lt;dbl&gt; 4834, 45223, 8458, 87697, 57802, 37723, 13485, 920…
## $ votes               &lt;dbl&gt; 886204, 793059, 418214, 995415, 1676169, 534658, 9…
## $ reviews             &lt;dbl&gt; 3777, 2843, 1934, 2425, 5312, 3917, 1752, 1752, 35…
## $ rating              &lt;dbl&gt; 7.9, 7.7, 7.0, 8.1, 9.0, 6.5, 8.7, 7.5, 8.5, 7.2, …</code></pre>
<ul>
<li>Are there any missing values (NAs)? Are all entries distinct or are there duplicate entries?</li>
</ul>
<pre class="r"><code>skim(movies)</code></pre>
<table>
<caption>(#tab:missing_values)Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">movies</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">2961</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">8</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">title</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">83</td>
<td align="right">0</td>
<td align="right">2907</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">genre</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">17</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">director</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">32</td>
<td align="right">0</td>
<td align="right">1366</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table style="width:100%;">
<colgroup>
<col width="18%" />
<col width="9%" />
<col width="12%" />
<col width="8%" />
<col width="8%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.00e+03</td>
<td align="right">9.95e+00</td>
<td align="right">1920.0</td>
<td align="right">2.00e+03</td>
<td align="right">2.00e+03</td>
<td align="right">2.01e+03</td>
<td align="right">2.02e+03</td>
<td align="left">▁▁▁▂▇</td>
</tr>
<tr class="even">
<td align="left">duration</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.10e+02</td>
<td align="right">2.22e+01</td>
<td align="right">37.0</td>
<td align="right">9.50e+01</td>
<td align="right">1.06e+02</td>
<td align="right">1.19e+02</td>
<td align="right">3.30e+02</td>
<td align="left">▃▇▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">gross</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.81e+07</td>
<td align="right">7.25e+07</td>
<td align="right">703.0</td>
<td align="right">1.23e+07</td>
<td align="right">3.47e+07</td>
<td align="right">7.56e+07</td>
<td align="right">7.61e+08</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">budget</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.06e+07</td>
<td align="right">4.37e+07</td>
<td align="right">218.0</td>
<td align="right">1.10e+07</td>
<td align="right">2.60e+07</td>
<td align="right">5.50e+07</td>
<td align="right">3.00e+08</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">cast_facebook_likes</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.24e+04</td>
<td align="right">2.05e+04</td>
<td align="right">0.0</td>
<td align="right">2.24e+03</td>
<td align="right">4.60e+03</td>
<td align="right">1.69e+04</td>
<td align="right">6.57e+05</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">votes</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.09e+05</td>
<td align="right">1.58e+05</td>
<td align="right">5.0</td>
<td align="right">1.99e+04</td>
<td align="right">5.57e+04</td>
<td align="right">1.33e+05</td>
<td align="right">1.69e+06</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">reviews</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.03e+02</td>
<td align="right">4.94e+02</td>
<td align="right">2.0</td>
<td align="right">1.99e+02</td>
<td align="right">3.64e+02</td>
<td align="right">6.31e+02</td>
<td align="right">5.31e+03</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">rating</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6.39e+00</td>
<td align="right">1.05e+00</td>
<td align="right">1.6</td>
<td align="right">5.80e+00</td>
<td align="right">6.50e+00</td>
<td align="right">7.10e+00</td>
<td align="right">9.30e+00</td>
<td align="left">▁▁▆▇▁</td>
</tr>
</tbody>
</table>
<p><em>There are no missing values as can be observed when analysing <code>n_missing</code>, however, there are duplicate values for some variables. What is especially interesting, is that there are duplicate Titles for movies. This can be observed through looking at <code>n_unique</code>: Even though there are a total of 2961 records, there only seem to be 2907 unique movie titles.</em></p>
<hr />
<ul>
<li>Produce a table with the count of movies by genre, ranked in descending order</li>
</ul>
<pre class="r"><code>count_moviesByGenre&lt;-movies%&gt;%
  group_by(genre)%&gt;%
  count(sort=TRUE)%&gt;%
  rename(&quot;number_of_movies&quot; = n)

count_moviesByGenre</code></pre>
<pre><code>## # A tibble: 17 × 2
## # Groups:   genre [17]
##    genre       number_of_movies
##    &lt;chr&gt;                  &lt;int&gt;
##  1 Comedy                   848
##  2 Action                   738
##  3 Drama                    498
##  4 Adventure                288
##  5 Crime                    202
##  6 Biography                135
##  7 Horror                   131
##  8 Animation                 35
##  9 Fantasy                   28
## 10 Documentary               25
## 11 Mystery                   16
## 12 Sci-Fi                     7
## 13 Family                     3
## 14 Musical                    2
## 15 Romance                    2
## 16 Western                    2
## 17 Thriller                   1</code></pre>
<p><em>There seems to be quite a large difference in the number of records across genres in this dataset, as there is information on 848 Comedy movies opposed to only 1 on Thrillers.</em></p>
<hr />
<ul>
<li>Produce a table with the average gross earning and budget (<code>gross</code> and <code>budget</code>) by genre. Calculate a variable <code>return_on_budget</code> which shows how many $ did a movie make at the box office for each $ of its budget. Rank genres by this <code>return_on_budget</code> in descending order.</li>
</ul>
<pre class="r"><code>avgGenre &lt;- movies%&gt;%
  group_by(genre)%&gt;%
  summarise(mean(gross), mean(budget))%&gt;%
  
  rename(&quot;Average_Gross&quot; = &quot;mean(gross)&quot;, &quot;Average_Budget&quot; = &quot;mean(budget)&quot;)%&gt;%
  
  mutate(return_on_budget = Average_Gross/Average_Budget)%&gt;%
  
  mutate(Average_Gross = dollar(Average_Gross), Average_Budget = dollar(Average_Budget))%&gt;% # The dollar function is from the scales package and allows us to make the numbers more easily readable.
  mutate(return_on_budget = round(return_on_budget, 3))%&gt;% #We round the return column to the 3rd nearest decimal.
  
  arrange(desc(return_on_budget))

avgGenre</code></pre>
<pre><code>## # A tibble: 17 × 4
##    genre       Average_Gross Average_Budget return_on_budget
##    &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;                     &lt;dbl&gt;
##  1 Musical     $92,084,000   $3,189,500               28.9  
##  2 Family      $149,160,478  $14,833,333              10.1  
##  3 Western     $20,821,884   $3,465,000                6.01 
##  4 Documentary $17,353,973   $5,887,852                2.95 
##  5 Horror      $37,713,738   $13,504,916               2.79 
##  6 Fantasy     $42,408,841   $17,582,143               2.41 
##  7 Comedy      $42,630,552   $24,446,319               1.74 
##  8 Mystery     $67,533,021   $39,218,750               1.72 
##  9 Animation   $98,433,792   $61,701,429               1.60 
## 10 Biography   $45,201,805   $28,543,696               1.58 
## 11 Adventure   $95,794,257   $66,290,069               1.44 
## 12 Drama       $37,465,371   $26,242,933               1.43 
## 13 Crime       $37,502,397   $26,596,169               1.41 
## 14 Romance     $31,264,848   $25,107,500               1.25 
## 15 Action      $86,583,860   $71,354,888               1.21 
## 16 Sci-Fi      $29,788,371   $27,607,143               1.08 
## 17 Thriller    $2,468        $300,000                  0.008</code></pre>
<hr />
<ul>
<li>Produce a table that shows the top 15 directors who have created the highest gross revenue in the box office. Don’t just show the total gross amount, but also the mean, median, and standard deviation per director.</li>
</ul>
<pre class="r"><code>topDirectors &lt;- movies%&gt;%
  group_by(director)%&gt;%
  summarise(total_gross = sum(gross), avg_gross = mean(gross), median_gross = median(gross), sd_gross = sd(gross))%&gt;%
  slice_max(order_by = total_gross, n = 15)%&gt;%
  
  mutate(total_gross = dollar(total_gross), avg_gross = dollar(avg_gross), median_gross = dollar(median_gross), sd_gross = dollar(sd_gross))

topDirectors</code></pre>
<pre><code>## # A tibble: 15 × 5
##    director          total_gross    avg_gross    median_gross sd_gross    
##    &lt;chr&gt;             &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;       
##  1 Steven Spielberg  $4,014,061,704 $174,524,422 $164,435,221 $101,421,051
##  2 Michael Bay       $2,231,242,537 $171,634,041 $138,396,624 $127,161,579
##  3 Tim Burton        $2,071,275,480 $129,454,718 $76,519,172  $108,726,924
##  4 Sam Raimi         $2,014,600,898 $201,460,090 $234,903,076 $162,126,632
##  5 James Cameron     $1,909,725,910 $318,287,652 $175,562,880 $309,171,337
##  6 Christopher Nolan $1,813,227,576 $226,653,447 $196,667,606 $187,224,133
##  7 George Lucas      $1,741,418,480 $348,283,696 $380,262,555 $146,193,880
##  8 Robert Zemeckis   $1,619,309,108 $124,562,239 $100,853,835 $91,300,279 
##  9 Clint Eastwood    $1,378,321,100 $72,543,216  $46,700,000  $75,487,408 
## 10 Francis Lawrence  $1,358,501,971 $271,700,394 $281,666,058 $135,437,020
## 11 Ron Howard        $1,335,988,092 $111,332,341 $101,587,923 $81,933,761 
## 12 Gore Verbinski    $1,329,600,995 $189,942,999 $123,207,194 $154,473,822
## 13 Andrew Adamson    $1,137,446,920 $284,361,730 $279,680,930 $120,895,765
## 14 Shawn Levy        $1,129,750,988 $102,704,635 $85,463,309  $65,484,773 
## 15 Ridley Scott      $1,128,857,598 $80,632,686  $47,775,715  $68,812,285</code></pre>
<hr />
<ul>
<li>Finally, ratings. Produce a table that describes how ratings are distributed by genre. We don’t want just the mean, but also, min, max, median, SD and some kind of a histogram or density graph that visually shows how ratings are distributed.</li>
</ul>
<pre class="r"><code>ratings &lt;- movies%&gt;%
  group_by(genre)%&gt;%
  summarise(avg_rating = mean(rating), min_rating = min(rating), max_rating = max(rating), median_rating = median(rating), sd_rating = sd(rating))%&gt;%
  arrange(desc(avg_rating))
ratings</code></pre>
<pre><code>## # A tibble: 17 × 6
##    genre       avg_rating min_rating max_rating median_rating sd_rating
##    &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;
##  1 Biography         7.11        4.5        8.9          7.2      0.760
##  2 Crime             6.92        4.8        9.3          6.9      0.849
##  3 Mystery           6.86        4.6        8.5          6.9      0.882
##  4 Musical           6.75        6.3        7.2          6.75     0.636
##  5 Drama             6.73        2.1        8.8          6.8      0.917
##  6 Documentary       6.66        1.6        8.5          7.4      1.77 
##  7 Sci-Fi            6.66        5          8.2          6.4      1.09 
##  8 Animation         6.65        4.5        8            6.9      0.968
##  9 Romance           6.65        6.2        7.1          6.65     0.636
## 10 Adventure         6.51        2.3        8.6          6.6      1.09 
## 11 Family            6.5         5.7        7.9          5.9      1.22 
## 12 Action            6.23        2.1        9            6.3      1.03 
## 13 Fantasy           6.15        4.3        7.9          6.45     0.959
## 14 Comedy            6.11        1.9        8.8          6.2      1.02 
## 15 Horror            5.83        3.6        8.5          5.9      1.01 
## 16 Western           5.7         4.1        7.3          5.7      2.26 
## 17 Thriller          4.8         4.8        4.8          4.8     NA</code></pre>
<pre class="r"><code>overall&lt;-ggplot(movies, aes(x=rating))+
  geom_histogram(color=&quot;black&quot;, fill=&quot;white&quot;)+
  geom_vline(aes(xintercept=mean(rating), color = &quot;Average Rating&quot;), linetype = &quot;dashed&quot;)+
  labs(title = &quot;Rating distribution&quot;, subtitle = &quot;A histogram on overall rating across genres&quot;, x = &quot;Rating&quot;)+
  scale_color_manual(name = &quot;Legend&quot;, values = c(&quot;Average Rating&quot; = &quot;orange&quot;))+ #We adjust the legend to display the proper label for the mean line
  theme_bw()
overall</code></pre>
<p><img src="/blogs/hw1_files/figure-html/hist_ratings-1.png" width="960" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rating_by_genre&lt;-ggplot(movies, aes(x=rating))+
  geom_histogram(color=&quot;black&quot;, fill=&quot;white&quot;)+
  facet_wrap(vars(genre), scales = &quot;free_y&quot;)+ #we decided that it would be more visually informative, if the y axis adapts from histogram to histogram.
  labs(title = &quot;Rating distribution&quot;, subtitle = &quot;Histograms per genre&quot;)+
  theme_bw()
rating_by_genre</code></pre>
<p><img src="/blogs/hw1_files/figure-html/hist_ratings-2.png" width="960" style="display: block; margin: auto;" /></p>
<hr />
<ul>
<li>Examine the relationship between <code>gross</code> and <code>cast_facebook_likes</code>. Produce a scatterplot and write one sentence discussing whether the number of facebook likes that the cast has received is likely to be a good predictor of how much money a movie will make at the box office. What variable are you going to map to the Y- and X- axes?</li>
</ul>
<pre class="r"><code>all_scatter_likes &lt;- ggplot(movies, aes(x=cast_facebook_likes, y=gross))+
  geom_point(aes(color=genre))+
  geom_smooth(method = &quot;lm&quot;)+
  
  scale_x_continuous(labels = number)+ #we use the scales package to enhance the axes&#39; readability 
  scale_y_continuous(labels = dollar)+
  
  labs(title = &quot;Likes and gross revenue&quot;, subtitle = &quot;An unadjusted look at the relationship between casts&#39; facebook popularity and the movie&#39;s gross revenue&quot;, x = &quot;Casts&#39; likes on facebook&quot;, y = &quot;Gross Revenue&quot;)+
  stat_regline_equation(label.y = 600000000, aes(label = ..eq.label..), size = 6)+
  stat_regline_equation(label.y = 550000000, aes(label = ..rr.label..), size = 6)+
  theme_bw()

all_scatter_likes</code></pre>
<p><img src="/blogs/hw1_files/figure-html/gross_on_fblikes-1.png" width="960" style="display: block; margin: auto;" /></p>
<pre class="r"><code>#In the following, we left out the visualization of outlying values in order to make the graph easier to read.
adjusted_scatter_likes &lt;- ggplot(movies,aes(x=cast_facebook_likes, y=gross))+

  geom_point(aes(color=genre))+
  geom_smooth(method = &quot;lm&quot;)+
  
  stat_regline_equation(label.y = 500000000, aes(label = ..eq.label..), size = 6)+
  stat_regline_equation(label.y = 450000000, aes(label = ..rr.label..), size = 6)+
  
  
  xlim(0, 150000)+ #we limit the display of values on the x and y axes to account for outliers.
  ylim(0,500000000)+
  
  labs(title = &quot;Likes and gross revenue&quot;, subtitle = &quot;An adjusted look at the relationship between casts&#39; facebook popularity and the movie&#39;s gross revenue&quot;, x = &quot;Casts&#39; likes on facebook&quot;, y = &quot;Gross Revenue&quot;)+

  theme_bw()

adjusted_scatter_likes</code></pre>
<p><img src="/blogs/hw1_files/figure-html/gross_on_fblikes-2.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>From the R square value of 0.079, one can infer that the correlation between the two variables is rather weak. This indicates that the casts’ Facebook popularity does not solely help to predict the gross revenue of a movie.</em></p>
<hr />
<ul>
<li>Examine the relationship between <code>gross</code> and <code>budget</code>. Produce a scatterplot and write one sentence discussing whether budget is likely to be a good predictor of how much money a movie will make at the box office.</li>
</ul>
<pre class="r"><code>all_scatter_budget &lt;- ggplot(movies, aes(x=budget, y=gross))+
  geom_point(aes(color=genre))+
  geom_smooth(method = &quot;lm&quot;)+
  
  scale_x_continuous(labels = dollar)+
  scale_y_continuous(labels = dollar)+
  
  stat_regline_equation(label.y = 500000000, aes(label = ..eq.label..), size = 6)+
  stat_regline_equation(label.y = 450000000, aes(label = ..rr.label..), size = 6)+


  labs(title = &quot;Budget and gross revenue&quot;, subtitle = &quot;A look at the relationship between the movie&#39;s budget and its gross revenue&quot;, x = &quot;Budget&quot;, y = &quot;Gross Revenue&quot;)+

  theme_bw()
all_scatter_budget</code></pre>
<p><img src="/blogs/hw1_files/figure-html/gross_on_budget-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>Compared to the casts’ facebook popularity, budget seems to be a stronger predictor of a movie’s gross revenue as the R squared value is closer to 1.</em></p>
<hr />
<ul>
<li>Examine the relationship between <code>gross</code> and <code>rating</code>. Produce a scatterplot, faceted by <code>genre</code> and discuss whether IMDB ratings are likely to be a good predictor of how much money a movie will make at the box office. Is there anything strange in this dataset?</li>
</ul>
<pre class="r"><code>all_scatter_rating &lt;- ggplot(movies, aes(x=rating, y=gross))+
  geom_point(aes(color=genre), size=0.5)+
  ylim(0,750000000)+
  geom_smooth(method = &quot;lm&quot;)+
  facet_wrap(vars(genre), scales = &quot;free_y&quot;)+ #we decide to only have a changing y axis across the charts to make identifying smaller values easier 
  
  scale_y_continuous(labels = dollar_format(scale = 1/10000000, prefix = &quot;m $&quot;))+ #we use the scales package to scale the y axis to million $
  
  labs(title = &quot;Rating and gross revenue&quot;, subtitle = &quot;A look at the relationship between a movie&#39;s rating and its gross revenue&quot;, x = &quot;Rating&quot;, y = &quot;Gross Revenue&quot;)+
  
  theme_bw()

all_scatter_rating</code></pre>
<p><img src="/blogs/hw1_files/figure-html/gross_on_rating-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>Overall, one can observe a positive correlation between a movie’s rating and its gross revenue, however, as with casts’ facebook likes, the correlation is weak. Due to the small sample size of some genres (e.g. Musical, Western and Sci-Fi), not all trendlines are representative.</em></p>
<hr />
</div>
<div id="returns-of-financial-stocks" class="section level1">
<h1>Returns of financial stocks</h1>
<pre class="r"><code>nyse &lt;- read_csv(here::here(&quot;data&quot;,&quot;nyse.csv&quot;))</code></pre>
<ul>
<li>Based on this dataset, create a table and a bar plot that shows the number of companies per sector, in descending order</li>
</ul>
<pre class="r"><code># YOUR CODE GOES HERE
sector_df&lt;-nyse%&gt;%
  group_by(sector)%&gt;%
  summarise(number = count(sector))%&gt;%
  arrange(desc(number))
sector_df</code></pre>
<pre><code>## # A tibble: 12 × 2
##    sector                number
##    &lt;chr&gt;                  &lt;int&gt;
##  1 Finance                   97
##  2 Consumer Services         79
##  3 Public Utilities          60
##  4 Capital Goods             45
##  5 Health Care               45
##  6 Energy                    42
##  7 Technology                40
##  8 Basic Industries          39
##  9 Consumer Non-Durables     31
## 10 Miscellaneous             12
## 11 Transportation            10
## 12 Consumer Durables          8</code></pre>
<pre class="r"><code>barplot_sector&lt;- ggplot(sector_df, aes(y=fct_reorder(sector, number), x=number))+
  geom_col(fill = &quot;darkblue&quot;, width = 0.5)+
  geom_text(aes(label = number), hjust = 3, color = &quot;white&quot;)+ #we display the # of companies and use hjust to move the labels to the left.
  labs(title = &quot;Sector differences&quot;, subtitle = &quot;The number of companies per sector&quot;, y = &quot;Sector&quot;, x= &quot;Number of companies&quot;)+
  
  theme_bw()

barplot_sector</code></pre>
<p><img src="/blogs/hw1_files/figure-html/companies_per_sector-1.png" width="960" style="display: block; margin: auto;" /></p>
<hr />
<ul>
<li>Next, let’s choose some stocks and their ticker symbols and download some data. You <strong>MUST</strong> choose 6 different stocks from the ones listed below; You should, however, add <code>SPY</code> which is the SP500 ETF (Exchange Traded Fund).</li>
</ul>
<pre class="r"><code># Notice the cache=TRUE argument in the chunk options. Because getting data is time consuming, 
# cache=TRUE means that once it downloads data, the chunk will not run again next time you knit your Rmd

myStocks &lt;- c(&quot;GREK&quot;,&quot;GME&quot;,&quot;AMC&quot;,&quot;AAPL&quot;,&quot;COW&quot;,&quot;TSLA&quot;,&quot;SPY&quot; ) %&gt;%
  tq_get(get  = &quot;stock.prices&quot;,
         from = &quot;2011-01-01&quot;,
         to   = &quot;2021-08-31&quot;) %&gt;%
  group_by(symbol) 

glimpse(myStocks) # examine the structure of the resulting data frame</code></pre>
<pre><code>## Rows: 16,018
## Columns: 8
## Groups: symbol [7]
## $ symbol   &lt;chr&gt; &quot;GREK&quot;, &quot;GREK&quot;, &quot;GREK&quot;, &quot;GREK&quot;, &quot;GREK&quot;, &quot;GREK&quot;, &quot;GREK&quot;, &quot;GREK…
## $ date     &lt;date&gt; 2011-12-08, 2011-12-09, 2011-12-12, 2011-12-13, 2011-12-14, …
## $ open     &lt;dbl&gt; 44.8, 44.1, 44.4, 44.8, 41.9, 41.8, 42.0, 40.9, 42.3, 42.1, 4…
## $ high     &lt;dbl&gt; 44.9, 44.7, 44.4, 44.8, 41.9, 42.0, 42.2, 43.4, 42.3, 42.1, 4…
## $ low      &lt;dbl&gt; 44.2, 44.1, 42.5, 42.0, 40.8, 41.8, 39.9, 40.4, 41.4, 42.1, 4…
## $ close    &lt;dbl&gt; 44.3, 44.4, 42.7, 42.3, 41.5, 42.0, 41.2, 41.0, 41.4, 42.1, 4…
## $ volume   &lt;dbl&gt; 1167, 667, 2700, 2633, 200, 1267, 3667, 1467, 1100, 167, 700,…
## $ adjusted &lt;dbl&gt; 38.3, 38.4, 36.9, 36.6, 36.0, 36.3, 35.7, 35.5, 35.8, 36.5, 3…</code></pre>
<hr />
<pre class="r"><code>#calculate daily returns
myStocks_returns_daily &lt;- myStocks %&gt;%
  tq_transmute(select     = adjusted, 
               mutate_fun = periodReturn, 
               period     = &quot;daily&quot;, 
               type       = &quot;log&quot;,
               col_rename = &quot;daily_returns&quot;,
               cols = c(nested.col))  

#calculate monthly  returns
myStocks_returns_monthly &lt;- myStocks %&gt;%
  tq_transmute(select     = adjusted, 
               mutate_fun = periodReturn, 
               period     = &quot;monthly&quot;, 
               type       = &quot;arithmetic&quot;,
               col_rename = &quot;monthly_returns&quot;,
               cols = c(nested.col)) 

#calculate yearly returns
myStocks_returns_annual &lt;- myStocks %&gt;%
  group_by(symbol) %&gt;%
  tq_transmute(select     = adjusted, 
               mutate_fun = periodReturn, 
               period     = &quot;yearly&quot;, 
               type       = &quot;arithmetic&quot;,
               col_rename = &quot;yearly_returns&quot;,
               cols = c(nested.col))</code></pre>
<ul>
<li>Create a table where you summarise monthly returns for each of the stocks and <code>SPY</code>; min, max, median, mean, SD.</li>
</ul>
<pre class="r"><code># YOUR CODE GOES HERE
summary_monthly&lt;-myStocks_returns_monthly%&gt;%
  group_by(symbol)%&gt;%
  summarise(min_return = min(monthly_returns), max_return = max(monthly_returns), median_return = median(monthly_returns), avg_return = mean(monthly_returns), sd_return = sd(monthly_returns))
summary_monthly</code></pre>
<pre><code>## # A tibble: 7 × 6
##   symbol min_return max_return median_return avg_return sd_return
##   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 AAPL       -0.181     0.217        0.0257     0.0245     0.0785
## 2 AMC        -0.504     5.25         0.00679    0.0798     0.611 
## 3 COW        -0.134     0.0762       0.00264   -0.00524    0.0485
## 4 GME        -0.687    16.3         -0.0118     0.142      1.45  
## 5 GREK       -0.332     0.369        0.00609    0.00365    0.110 
## 6 SPY        -0.125     0.127        0.0174     0.0123     0.0381
## 7 TSLA       -0.224     0.811        0.0148     0.0523     0.176</code></pre>
<hr />
<ul>
<li>Plot a density plot, using <code>geom_density()</code>, for each of the stocks</li>
</ul>
<pre class="r"><code># YOUR CODE GOES HERE
density&lt;-ggplot(myStocks_returns_monthly, aes(x=monthly_returns))+
  geom_density()+
  facet_wrap(vars(symbol), scales=&quot;free&quot;)+ #we use free scales per density plot in order to enhance readability.
  
  labs(title = &quot;Return Distribution&quot;, subtitle = &quot;Density plots on monthly returns&quot;, x = &quot;Monthly return&quot;, y = &quot;Percentage&quot;)

density</code></pre>
<p><img src="/blogs/hw1_files/figure-html/density_monthly_returns-1.png" width="960" style="display: block; margin: auto;" /></p>
<ul>
<li>What can you infer from this plot? Which stock is the riskiest? The least risky?</li>
</ul>
<p><em>From the density plots, one can observe that volatility in monthly return varies widely across the stocks/ETF. For instance, the returns of COW seem to be more evenly distributed than GME, indicating a lower risk when investing into them. In our eyes, GME seems to be the riskiest stock, while an investment into GREK carries the least risk. The latter is understandable as the GREK ETF is diversified and holds shares of the largest and most liquid companies in Greece (<a href="https://www.globalxetfs.com/funds/grek/">source</a>).</em></p>
<p><em>Looking at the x axis, one can also observe a large difference in the range of monthly returns across the instruments. Interestingly, most of the distribution lies around the 0 mark for all displayed tickers.</em></p>
<hr />
<ul>
<li>Finally, make a plot that shows the expected monthly return (mean) of a stock on the Y axis and the risk (standard deviation) in the X-axis. Please use <code>ggrepel::geom_text_repel()</code> to label each stock</li>
</ul>
<pre class="r"><code># YOUR CODE GOES HERE
scatter_return_volatility &lt;- ggplot(summary_monthly, aes(x=sd_return, y=avg_return, label=symbol))+
  geom_point()+
  geom_smooth(method = &quot;lm&quot;, se = F)+ #in this case, we do not want a confidence interval around the regression line
  geom_text_repel()+
  
  labs(title = &quot;Risk vs. Reward&quot;, subtitle = &quot;A look at the relationship between the instruments&#39; standard deviation and average monthly return&quot;, x = &quot;Standard deviation&quot;, y = &quot;Average monthly return&quot;)+
  
  theme_bw()

scatter_return_volatility</code></pre>
<p><img src="/blogs/hw1_files/figure-html/risk_return_plot-1.png" width="960" style="display: block; margin: auto;" /></p>
<ul>
<li>What can you infer from this plot? Are there any stocks which, while being riskier, do not have a higher expected return?</li>
</ul>
<p><em>Generally, the market seems to reward higher risk with higher return. However, there are minor exceptions in our sample: GREK, indexing the Greek market, has a higher SD than SPY, yet its average monthly return is lower. A good approximation for comparing risk and reward across instruments is the blue linear regression line. Tickers above this line indicate a greater reward for a given risk compared to tickers below that line</em></p>
<hr />
</div>
<div id="on-your-own-ibm-hr-analytics" class="section level1">
<h1>On your own: IBM HR Analytics</h1>
<pre class="r"><code>hr_dataset &lt;- read_csv(here::here(&quot;data&quot;, &quot;datasets_1067_1925_WA_Fn-UseC_-HR-Employee-Attrition.csv&quot;))
glimpse(hr_dataset)</code></pre>
<pre><code>## Rows: 1,470
## Columns: 35
## $ Age                      &lt;dbl&gt; 41, 49, 37, 33, 27, 32, 59, 30, 38, 36, 35, 2…
## $ Attrition                &lt;chr&gt; &quot;Yes&quot;, &quot;No&quot;, &quot;Yes&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;…
## $ BusinessTravel           &lt;chr&gt; &quot;Travel_Rarely&quot;, &quot;Travel_Frequently&quot;, &quot;Travel…
## $ DailyRate                &lt;dbl&gt; 1102, 279, 1373, 1392, 591, 1005, 1324, 1358,…
## $ Department               &lt;chr&gt; &quot;Sales&quot;, &quot;Research &amp; Development&quot;, &quot;Research …
## $ DistanceFromHome         &lt;dbl&gt; 1, 8, 2, 3, 2, 2, 3, 24, 23, 27, 16, 15, 26, …
## $ Education                &lt;dbl&gt; 2, 1, 2, 4, 1, 2, 3, 1, 3, 3, 3, 2, 1, 2, 3, …
## $ EducationField           &lt;chr&gt; &quot;Life Sciences&quot;, &quot;Life Sciences&quot;, &quot;Other&quot;, &quot;L…
## $ EmployeeCount            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ EmployeeNumber           &lt;dbl&gt; 1, 2, 4, 5, 7, 8, 10, 11, 12, 13, 14, 15, 16,…
## $ EnvironmentSatisfaction  &lt;dbl&gt; 2, 3, 4, 4, 1, 4, 3, 4, 4, 3, 1, 4, 1, 2, 3, …
## $ Gender                   &lt;chr&gt; &quot;Female&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Female&quot;, &quot;Male&quot;, &quot;…
## $ HourlyRate               &lt;dbl&gt; 94, 61, 92, 56, 40, 79, 81, 67, 44, 94, 84, 4…
## $ JobInvolvement           &lt;dbl&gt; 3, 2, 2, 3, 3, 3, 4, 3, 2, 3, 4, 2, 3, 3, 2, …
## $ JobLevel                 &lt;dbl&gt; 2, 2, 1, 1, 1, 1, 1, 1, 3, 2, 1, 2, 1, 1, 1, …
## $ JobRole                  &lt;chr&gt; &quot;Sales Executive&quot;, &quot;Research Scientist&quot;, &quot;Lab…
## $ JobSatisfaction          &lt;dbl&gt; 4, 2, 3, 3, 2, 4, 1, 3, 3, 3, 2, 3, 3, 4, 3, …
## $ MaritalStatus            &lt;chr&gt; &quot;Single&quot;, &quot;Married&quot;, &quot;Single&quot;, &quot;Married&quot;, &quot;Ma…
## $ MonthlyIncome            &lt;dbl&gt; 5993, 5130, 2090, 2909, 3468, 3068, 2670, 269…
## $ MonthlyRate              &lt;dbl&gt; 19479, 24907, 2396, 23159, 16632, 11864, 9964…
## $ NumCompaniesWorked       &lt;dbl&gt; 8, 1, 6, 1, 9, 0, 4, 1, 0, 6, 0, 0, 1, 0, 5, …
## $ Over18                   &lt;chr&gt; &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, …
## $ OverTime                 &lt;chr&gt; &quot;Yes&quot;, &quot;No&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;No&quot;, &quot;No&quot;, &quot;Yes&quot;,…
## $ PercentSalaryHike        &lt;dbl&gt; 11, 23, 15, 11, 12, 13, 20, 22, 21, 13, 13, 1…
## $ PerformanceRating        &lt;dbl&gt; 3, 4, 3, 3, 3, 3, 4, 4, 4, 3, 3, 3, 3, 3, 3, …
## $ RelationshipSatisfaction &lt;dbl&gt; 1, 4, 2, 3, 4, 3, 1, 2, 2, 2, 3, 4, 4, 3, 2, …
## $ StandardHours            &lt;dbl&gt; 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 8…
## $ StockOptionLevel         &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 3, 1, 0, 2, 1, 0, 1, 1, 0, …
## $ TotalWorkingYears        &lt;dbl&gt; 8, 10, 7, 8, 6, 8, 12, 1, 10, 17, 6, 10, 5, 3…
## $ TrainingTimesLastYear    &lt;dbl&gt; 0, 3, 3, 3, 3, 2, 3, 2, 2, 3, 5, 3, 1, 2, 4, …
## $ WorkLifeBalance          &lt;dbl&gt; 1, 3, 3, 3, 3, 2, 2, 3, 3, 2, 3, 3, 2, 3, 3, …
## $ YearsAtCompany           &lt;dbl&gt; 6, 10, 0, 8, 2, 7, 1, 1, 9, 7, 5, 9, 5, 2, 4,…
## $ YearsInCurrentRole       &lt;dbl&gt; 4, 7, 0, 7, 2, 7, 0, 0, 7, 7, 4, 5, 2, 2, 2, …
## $ YearsSinceLastPromotion  &lt;dbl&gt; 0, 1, 0, 3, 2, 3, 0, 0, 1, 7, 0, 0, 4, 1, 0, …
## $ YearsWithCurrManager     &lt;dbl&gt; 5, 7, 0, 0, 2, 6, 0, 0, 8, 7, 3, 8, 3, 2, 3, …</code></pre>
<pre class="r"><code>head(hr_cleaned)</code></pre>
<pre><code>## # A tibble: 6 × 19
##     age attrition daily_rate department      distance_from_ho… education  gender
##   &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;                       &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; 
## 1    41 Yes             1102 Sales                           1 College    Female
## 2    49 No               279 Research &amp; Dev…                 8 Below Col… Male  
## 3    37 Yes             1373 Research &amp; Dev…                 2 College    Male  
## 4    33 No              1392 Research &amp; Dev…                 3 Master     Female
## 5    27 No               591 Research &amp; Dev…                 2 Below Col… Male  
## 6    32 No              1005 Research &amp; Dev…                 2 College    Male  
## # … with 12 more variables: job_role &lt;chr&gt;, environment_satisfaction &lt;chr&gt;,
## #   job_satisfaction &lt;chr&gt;, marital_status &lt;chr&gt;, monthly_income &lt;dbl&gt;,
## #   num_companies_worked &lt;dbl&gt;, percent_salary_hike &lt;dbl&gt;,
## #   performance_rating &lt;chr&gt;, total_working_years &lt;dbl&gt;,
## #   work_life_balance &lt;chr&gt;, years_at_company &lt;dbl&gt;,
## #   years_since_last_promotion &lt;dbl&gt;</code></pre>
<pre class="r"><code>skim(hr_cleaned)</code></pre>
<table>
<caption><span id="tab:headerHRData">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">hr_cleaned</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">1470</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">19</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">10</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">attrition</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">department</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">22</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">education</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">job_role</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">25</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">environment_satisfaction</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">job_satisfaction</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">marital_status</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">performance_rating</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">work_life_balance</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">36.92</td>
<td align="right">9.14</td>
<td align="right">18</td>
<td align="right">30</td>
<td align="right">36</td>
<td align="right">43</td>
<td align="right">60</td>
<td align="left">▂▇▇▃▂</td>
</tr>
<tr class="even">
<td align="left">daily_rate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">802.49</td>
<td align="right">403.51</td>
<td align="right">102</td>
<td align="right">465</td>
<td align="right">802</td>
<td align="right">1157</td>
<td align="right">1499</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="odd">
<td align="left">distance_from_home</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">9.19</td>
<td align="right">8.11</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">7</td>
<td align="right">14</td>
<td align="right">29</td>
<td align="left">▇▅▂▂▂</td>
</tr>
<tr class="even">
<td align="left">monthly_income</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6502.93</td>
<td align="right">4707.96</td>
<td align="right">1009</td>
<td align="right">2911</td>
<td align="right">4919</td>
<td align="right">8379</td>
<td align="right">19999</td>
<td align="left">▇▅▂▁▂</td>
</tr>
<tr class="odd">
<td align="left">num_companies_worked</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.69</td>
<td align="right">2.50</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">9</td>
<td align="left">▇▃▂▂▁</td>
</tr>
<tr class="even">
<td align="left">percent_salary_hike</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">15.21</td>
<td align="right">3.66</td>
<td align="right">11</td>
<td align="right">12</td>
<td align="right">14</td>
<td align="right">18</td>
<td align="right">25</td>
<td align="left">▇▅▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">total_working_years</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">11.28</td>
<td align="right">7.78</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">10</td>
<td align="right">15</td>
<td align="right">40</td>
<td align="left">▇▇▂▁▁</td>
</tr>
<tr class="even">
<td align="left">years_at_company</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7.01</td>
<td align="right">6.13</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">9</td>
<td align="right">40</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">years_since_last_promotion</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.19</td>
<td align="right">3.22</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">15</td>
<td align="left">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
<p><em>The <code>hr_cleaned</code> dataset holds fictional information of a total of 1470 employees on variables such as the employees’ education, job specifics, performance and attrition. All in all, there are 9 numeric and 10 non-numeric variables</em></p>
<p><em>Given the wide range of information, one can try to make inferences about dependencies among variables. For example, it might be interesting to find out if a combination of variables might be a good predictor for an employee’s decision to leave the company (<code>attrition</code> = Yes).</em></p>
<ul>
<li>How often do people leave the company (<code>attrition</code>)</li>
</ul>
<pre class="r"><code>number_attrition&lt;-hr_cleaned%&gt;%
  group_by(attrition)%&gt;%
  summarize(number_count = count(attrition))%&gt;%
  mutate(perc = number_count/sum(number_count)) #we introduce a second column, namely percent, to represent the count as a percentage of the total

number_attrition</code></pre>
<pre><code>## # A tibble: 2 × 3
##   attrition number_count  perc
##   &lt;chr&gt;            &lt;int&gt; &lt;dbl&gt;
## 1 No                1233 0.839
## 2 Yes                237 0.161</code></pre>
<p><em>Looking at the sheer counts of YES and NO entries for the <code>attrition</code> column, around 237 of all employees have left the company. This corresponds to a percentage of around 16% of all recorded employees. At the same time, 1233 employees have been staying with the company.</em></p>
<p><em>In addition, it might be interesting to plot the distribution of age faceted by the attrition value to see whether one can make any inferences from that relationship.</em></p>
<p><img src="/blogs/hw1_files/figure-html/facet_age_dist_by_attrition-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>Looking at the two density plots, it is observable that values in the age variable tend to be lower for <code>Attrition</code> = Yes. One might speculate that younger employees tend to leave the company more often than older employees, because, on average, it is easier for them to find and adapt to a new job. Furthermore, as the analysis further below shows, compared to their older colleagues, they tend to have a lower salary, giving them less reason to stay with the company.</em></p>
<ul>
<li>How are <code>age</code>, <code>years_at_company</code>, <code>monthly_income</code> and <code>years_since_last_promotion</code> distributed? can you roughly guess which of these variables is closer to Normal just by looking at summary statistics?</li>
</ul>
<pre class="r"><code>n&lt;-length(hr_cleaned$age) 

pic_data&lt;-data.frame(cbind(c(hr_cleaned$age,hr_cleaned$monthly_income, 
                  hr_cleaned$years_since_last_promotion), 
                c(rep(&quot;age&quot;,n),rep(&quot;monthly_income&quot;,n),rep(&quot;years_since_last_promotion&quot;,n)))) 
colnames(pic_data)&lt;-c(&quot;Num&quot;,&quot;Attribute&quot;) 
pic_data$Num&lt;-as.integer(pic_data$Num) 

distribution&lt;-ggplot(pic_data, aes(x=Num))+ 
  geom_histogram()+ 
  facet_wrap(vars(Attribute), scale=&quot;free&quot;)+ 
  labs(title = &quot;Distribution across the dataset&quot;, subtitle = &quot;Counts of values for age, monthly income and years since last promotion&quot;, x=&quot;&quot;,y=&quot;Frequency&quot;)+ 
  
  theme_bw() 
distribution </code></pre>
<p><img src="/blogs/hw1_files/figure-html/age_years_income_promotion-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>Looking at the three graphs, values for the age variable seem to be the most normally distributed, even though the distribution is skewed slightly to the right. This can be explained by the fact that the majority of the workforce lies in the age group 25-40. The remaining two graphs are skewed heavily to the right. The skewness of monthly income can be explained by the fact that most salaries tend to center around the mean, while there are large outliers on the higher side of income. Similarly, the distribution of <code>years_since_last_promotion</code> is in accordance with the frequency of employee promotion; people usually get promoted every 1-3 years.</em></p>
<ul>
<li>How are <code>job_satisfaction</code> and <code>work_life_balance</code> distributed? Don’t just report counts, but express categories as % of total.</li>
</ul>
<pre class="r"><code>hr_satis &lt;- hr_cleaned %&gt;% 
  group_by(job_satisfaction) %&gt;% 
  count(sort=TRUE) %&gt;% 
  rename(count=n)%&gt;%
  mutate(percent=count/1470)%&gt;%
  mutate(percent = percent(percent))


hr_satis </code></pre>
<pre><code>## # A tibble: 4 × 3
## # Groups:   job_satisfaction [4]
##   job_satisfaction count percent
##   &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;  
## 1 Very High          459 31%    
## 2 High               442 30%    
## 3 Low                289 20%    
## 4 Medium             280 19%</code></pre>
<pre class="r"><code>work_life_satis &lt;- hr_cleaned %&gt;% 
  group_by(work_life_balance) %&gt;% 
  count(sort=TRUE) %&gt;% 
  rename(count=n)%&gt;%
  mutate(percent=count/1470)%&gt;%
  mutate(percent = percent(percent))
 
work_life_satis </code></pre>
<pre><code>## # A tibble: 4 × 3
## # Groups:   work_life_balance [4]
##   work_life_balance count percent
##   &lt;chr&gt;             &lt;int&gt; &lt;chr&gt;  
## 1 Better              893 61%    
## 2 Good                344 23%    
## 3 Best                153 10%    
## 4 Bad                  80 5%</code></pre>
<p><em>As for job satisfaction, 61% of employees reported that they are very highly or highly satisfied with their work while 19% of employees showed a low job satisfaction level. In general, job satisfaction levels seem to be evenly distributed throughout employees.</em></p>
<p><em>As for work-life balance,the majority (60%) of employees indicate that they have a better balance and only 5% think their work-life balance is bad.</em></p>
<ul>
<li>Is there any relationship between <code>monthly_income</code> and <code>education</code>? <code>monthly_income</code> and <code>gender</code>?</li>
</ul>
<pre class="r"><code>plot1 &lt;- ggplot(hr_cleaned, aes(x = fct_reorder(education, -monthly_income), y=monthly_income))+ #we include a negative &quot;-&quot; sign infront of monthly_income in the fct_reorder function, in order to sort the x axis based on decreasing y values
  geom_boxplot()+
  
  scale_y_continuous(labels = dollar)+
  
  labs(title = &quot;Education vs income&quot;, subtitle = &quot;A look at an employee&#39;s academic background and monthly income&quot;, x = &quot;Education&quot;, y = &quot;Monthly income&quot;)+
  
  theme_bw()
plot1 </code></pre>
<p><img src="/blogs/hw1_files/figure-html/income_education-1.png" width="960" style="display: block; margin: auto;" /></p>
<pre class="r"><code>plot2 &lt;-ggplot(hr_cleaned, aes(x = fct_reorder(gender, -monthly_income), y=monthly_income))+ 
  geom_boxplot()+
  
  scale_y_continuous(label = dollar)+
  
  labs(title = &quot;Gender vs income&quot;, subtitle = &quot;A look at an employee&#39;s sex and monthly income&quot;, x = &quot;Gender&quot;, y = &quot;Monthly income&quot;)+
  
  theme_bw()
plot2 </code></pre>
<p><img src="/blogs/hw1_files/figure-html/income_education-2.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>The average monthly income seems to be based on the level of education. We can infer from the box plot that higher the education level, the higher the monthly income. There also exist a couple of outliers within the dataset - as some masters students tend to be paid higher than others. This could be relative for specific schools / universities and exceptional candidates that are paid highly for particular roles.</em></p>
<p><em>Interestingly, salaries don’t differ across genders as may be expected.</em></p>
<ul>
<li>Plot a boxplot of income vs job role. Make sure the highest-paid job roles appear first</li>
</ul>
<pre class="r"><code>income_vs_job &lt;- ggplot(hr_cleaned, aes(x=fct_reorder(job_role, -monthly_income), y=monthly_income)) + 
  geom_boxplot()+
  
  scale_y_continuous(labels = dollar)+
  
  labs(title = &quot;Income distribution by job&quot;, subtitle = &quot;A look at the relationship between job titles and monthly income&quot;, x = &quot;Job&quot; , y=&quot;Monthly income&quot;)+
  
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) #we adjust the labels on the x axis such that they are vertically aligned

  

income_vs_job</code></pre>
<p><img src="/blogs/hw1_files/figure-html/income_vs_job-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>Across job roles, salaries differ significantly. For instance the monthly median salary for Managers is $17,500 while the one for Sales Representatives is just above $2,500. In addition, one can observe three salary groups: 1) around $2,700 2) around $7,000 and 3) around $17,000)</em></p>
<ul>
<li>Calculate and plot a bar chart of the mean (or median?) income by education level.</li>
</ul>
<pre class="r"><code>#We opted for plotting the MEDIAN monthly income, as it is typically less prone to outliers

median_income &lt;- hr_cleaned%&gt;%
  group_by(education)%&gt;%
  summarise(median_monthly_income = median(monthly_income))%&gt;%
  
  ggplot(aes(x = fct_reorder(education, -median_monthly_income), y = median_monthly_income))+
    geom_col(fill = &quot;lightblue&quot;)+
  
    scale_y_continuous(labels = dollar)+
  
    labs(title = &quot;Median income by education&quot;, subtitle = &quot;A look at the relationship between academic background and median monthly income&quot;, x = &quot;Education&quot; , y=&quot;Median monthly income&quot;)+
  
    theme_bw()

median_income</code></pre>
<p><img src="/blogs/hw1_files/figure-html/bar_income_edu-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>The median salaries across education levels are aligned with the distribution of the salaries. PhDs have the highest median salary while employees without a college degree have the lowest median salary. Interestingly, the median salary for College graduates is slightly higher than the one for Bachelor graduates, given that the higher qualification is a Bachelors degree.</em></p>
<ul>
<li>Plot the distribution of income by education level. Use a facet_wrap and a theme from <code>ggthemes</code></li>
</ul>
<pre class="r"><code>plot7 &lt;- hr_cleaned %&gt;%  
  group_by(education) %&gt;%  
  ggplot(aes(x=monthly_income))+ 
    geom_histogram(fill = &quot;lightblue&quot;)+
    facet_wrap(vars(education), scales = &quot;free_y&quot;)+
  
    scale_x_continuous(labels = dollar)+
  
    labs(title = &quot;Income distribution by education&quot;, subtitle = &quot;A look at the relationship between edcuation level and monthly income&quot;, x = &quot;Monthly income&quot; , y=&quot;Count&quot;)+
  
    ggthemes::theme_stata()+
    theme(plot.background = element_blank()) #we remove the blue background to make the design more coherent
plot7 </code></pre>
<p><img src="/blogs/hw1_files/figure-html/dist_income_education-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>Even though the total number of employees differs heavily across the educational backgrounds, the overall distribution stays similar. One can observe a reduction in counts of employees for salaries between $12,000 and $17,000. The frequency of employees tends to increase at the higher end of monthly income levels.</em></p>
<p><em>A similar picture is shown in the following density plot:</em></p>
<p><img src="/blogs/hw1_files/figure-html/density_plot-1.png" width="960" style="display: block; margin: auto;" /></p>
<ul>
<li>Plot income vs age, faceted by <code>job_role</code></li>
</ul>
<pre class="r"><code>plot8 &lt;- ggplot(hr_cleaned, aes(x=age, y=monthly_income))+ 
  geom_point(size=0.1)+ 
  geom_smooth(method = &quot;lm&quot;)+
  facet_wrap(vars(job_role), scales = &quot;free&quot;)+
  
  scale_y_continuous(labels = dollar)+
  
  labs(title = &quot;Income by age and job title&quot;, subtitle = &quot;A look at the relationship between age, job title and monthly income level&quot;, x = &quot;Age&quot; , y=&quot;Monthly income&quot;)+
  
  ggthemes::theme_stata()+
  theme(plot.background = element_blank())

plot8 </code></pre>
<p><img src="/blogs/hw1_files/figure-html/income_age_job-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>The positive relationship between age and income stays consistent across job titles, i.e. the higher the age, the higher the monthly income. The strength of relationship, however, varies. For instance, the increase in salaries for research directors is higher than for research scientists.</em></p>
<hr />
</div>
<div id="challenge-1-replicating-a-chart" class="section level1">
<h1>Challenge 1: Replicating a chart</h1>
<p><em>We would like to replicate the following chart.</em></p>
<p><img src="/Users/jyc/Desktop/my-website/images/vaxxes_by_state_red_blue_every_county_070321_1.jpg" width="90%" style="display: block; margin: auto;" /></p>
<p><em>First we do some cleaning. As the vaccination data is time series, but we are only interested in the most recent status of vacc. percent per county, we can limit our dataframe to Sep. 3rd data.</em></p>
<p><em>In addition, we add a column to the election dataset which calculates the number of votes for one candidate as a percentage of the total number of votes in every given county.</em></p>
<pre class="r"><code>#as there are multiple dates for vacc statuses, and we are only interested in the most recent one, we can do some cleaning. Data from Sep. 3rd, 2021, seems to be most recent.

vaccinations_recent &lt;- vaccinations %&gt;%
  filter(date==&quot;09/03/2021&quot;)

#we can also include an additional coloumn to the election dataset, indicating the number of votes for one candidate as a percentage of whole

elections_perc &lt;- election2020_results%&gt;%
  mutate(perc_votes = candidatevotes/totalvotes)</code></pre>
<p><em>Next up, we create a new dataframe, based on joined values from the three original ones. Here, we only include the data really necessary for the reproduction of the graph.</em></p>
<p><em>Let’s have a sneak peak at the output dataframe. It looks like this is all the data we really need.</em></p>
<pre class="r"><code>#We decide to just join coloumn series_complete_pop_pct from the vacc dataset, as this should suffice to recreate the graph. We use inner join here, as we have a key variable, i.e. fips, to join all three datasets by.

#We also rename the coloumns to make their names a little more easy on the tongue.

joined_frame &lt;- inner_join(population, vaccinations_recent[,c(&quot;fips&quot;, &quot;series_complete_pop_pct&quot;) ], by = &quot;fips&quot;)%&gt;%
  rename(&quot;vacc_perc&quot; = &quot;series_complete_pop_pct&quot;, &quot;pop&quot; = &quot;pop_estimate_2019&quot;)

#Similarly, we join parts of the cleaned election data, and filter out records other than votes for Trump, as they are not needed for the graph. In addition, we sum up perc_votes because there is sometimes data for different ways of voting, i.e. early vote, election day, provisional.
elections_perc &lt;- elections_perc%&gt;%
  filter(mode == &quot;TOTAL&quot;)


joined_frame &lt;- inner_join(joined_frame, elections_perc[,c(&quot;fips&quot;, &quot;candidate&quot;, &quot;perc_votes&quot;)])%&gt;%
  filter(candidate==&quot;DONALD J TRUMP&quot;)
  # filter(mode == &quot;TOTAL&quot;)
  # group_by(fips, pop, vacc_perc, candidate, )%&gt;%
  # summarise(sum(perc_votes))%&gt;%
  # rename(&quot;perc_votes_total&quot; = &quot;sum(perc_votes)&quot;) #sum, to take into consideration all kinds of voting methods.

head(joined_frame) #we can have a look at the dataset. It looks like we have all the data we need for visualization</code></pre>
<pre><code>## # A tibble: 6 × 5
##   fips     pop vacc_perc candidate      perc_votes
##   &lt;chr&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt;
## 1 01001  55869      30.5 DONALD J TRUMP      0.714
## 2 01003 223234      37.9 DONALD J TRUMP      0.762
## 3 01005  24686      31.3 DONALD J TRUMP      0.535
## 4 01007  22394      26.6 DONALD J TRUMP      0.784
## 5 01009  57826      22.6 DONALD J TRUMP      0.896
## 6 01011  10101      38.4 DONALD J TRUMP      0.248</code></pre>
<p><em>Now that we have created the dataframe with all necessary data, let’s get to the attractive part of this exercise: making a beautiful plot.</em></p>
<pre class="r"><code>plot_counties &lt;- ggplot(joined_frame, aes(x=perc_votes, vacc_perc))+
  geom_rect(aes(xmin = 0, xmax = 0.45, ymin = 0, ymax = 100), fill = &quot;#A6A8FB&quot;)+ #we add three boxes to the plot that have HEX values for the blue, purple and red colours respectively.
  geom_rect(aes(xmin = 0.45, xmax = 0.55, ymin = 0, ymax = 100), fill = &quot;#D2A6D2&quot;)+
  geom_rect(aes(xmin = 0.55, xmax = 1, ymin = 0, ymax = 100), fill = &quot;#FDA7A7&quot;)+
 
  geom_hline(aes(yintercept = mean(vacc_perc)), color = &quot;darkblue&quot;, size = 1, linetype = &quot;dashed&quot;)+
  geom_hline(aes(yintercept = 85), color = &quot;yellow&quot;, size = 1, linetype = &quot;dashed&quot;)+
  
  geom_point(aes(size=pop), alpha = 1/3)+
  geom_smooth(method = &quot;lm&quot;)+
  
  
  
  
  annotate(&quot;text&quot;, x = 0.05, y = 39, label = &quot;ACTUAL&quot;, size = 6)+
  annotate(&quot;text&quot;, x = 0.1, y = 87, label = &quot;HERD IMMUNITY&quot;, size = 6)+
  
  stat_regline_equation(label.y = 20, aes(label = ..eq.label..), size = 6)+
  stat_regline_equation(label.y = 10, aes(label = ..rr.label..), size = 6)+

  
  scale_color_manual(name = &quot;Legend&quot;, values = c(&quot;Average Vaccination Rate&quot; = &quot;darkblue&quot;, &quot;Herd Immunity Threshhold&quot;= &quot;yellow&quot;))+ #We adjust the legend to display the proper label for the mean line


  
  labs(title = &quot;COVID19 vaccination levels versus Trump voting&quot;, subtitle = &quot;A look at the relationship between 2020 US election results and percentages of fully vaccinated people, per county as of Sep. 3rd, 2021&quot;, x = &quot;Trump voting&quot;, y = &quot;County&#39;s percentage of fully vaccinated people&quot;)+
  
  theme_bw()

plot_counties</code></pre>
<p><img src="/blogs/hw1_files/figure-html/visualize_election_vacc_pop-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>It seems like there are a number of outliers in the dataset. 276 counties have reported a full vaccination count of 0 for the Sep. 3rd collection. For instance, as you can see in the following output dataframe, Bexar county, home to a population of 2003554, reported a vaccination rate of 0%.</em></p>
<pre class="r"><code>filter(joined_frame[ ,c(&quot;fips&quot;, &quot;pop&quot;, &quot;vacc_perc&quot;)], fips==48029)</code></pre>
<pre><code>## # A tibble: 1 × 3
##   fips      pop vacc_perc
##   &lt;chr&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 48029 2003554         0</code></pre>
<p><em>It might be appropriate, to exclude records with vacc_perc = 0 from out dataset, as it seems very hard to believe that in a county like Bexar, home to 2003554 people, not a single one is fully vaccinated. A data collection error like this potentially has a large impact on the regression line. We therefore create an adjusted DF.</em></p>
<pre class="r"><code>#we first exclude records with vacc_perc equal to 0
adj_joined_fram &lt;- joined_frame%&gt;%
  filter(vacc_perc!=0)

#here, we simply replicate the plot, but this time with adjusted values.
adj_plot_counties &lt;- ggplot(adj_joined_fram, aes(x = perc_votes, y = vacc_perc))+
  geom_rect(aes(xmin = 0, xmax = 0.45, ymin = 0, ymax = 100), fill = &quot;#A6A8FB&quot;)+
  geom_rect(aes(xmin = 0.45, xmax = 0.55, ymin = 0, ymax = 100), fill = &quot;#D2A6D2&quot;)+
  geom_rect(aes(xmin = 0.55, xmax = 1, ymin = 0, ymax = 100), fill = &quot;#FDA7A7&quot;)+
  
  geom_hline(aes(yintercept = mean(vacc_perc)), color = &quot;darkblue&quot;, size = 1, linetype = &quot;dashed&quot;)+
  geom_hline(aes(yintercept = 85), color = &quot;yellow&quot;, size = 1, linetype = &quot;dashed&quot;)+

  geom_point(aes(size = pop), alpha = 1/3)+
  geom_smooth(method = &quot;lm&quot;)+
  
  annotate(&quot;text&quot;, x = 0.05, y = 43, label = &quot;ACTUAL&quot;, size = 6)+
  annotate(&quot;text&quot;, x = 0.1, y = 87, label = &quot;HERD IMMUNITY&quot;, size = 6)+
  
  stat_regline_equation(label.y = 20, aes(label = ..eq.label..), size = 6)+
  stat_regline_equation(label.y = 10, aes(label = ..rr.label..), size = 6)+
  
  labs(title = &quot;ADJUSTED - COVID19 vaccination levels versus Trump voting&quot;, subtitle = &quot;An adjusted look at the relationship between 2020 US election results and percentages of fully vaccinated people, per county as of Sep. 3rd, 2021&quot;, x = &quot;Trump voting&quot;, y = &quot;County&#39;s percentage of fully vaccinated people&quot;)+

  theme_bw()
adj_plot_counties</code></pre>
<p><img src="/blogs/hw1_files/figure-html/adjusted_visualize_election_vacc_pop-1.png" width="960" style="display: block; margin: auto;" /></p>
<p><em>As seen above, excluding the outlying vaccination rates of 0%, the fit of the model (R square) goes up by 0.15</em></p>
</div>
<div id="details" class="section level1">
<h1>Details</h1>
<ul>
<li>Who did you collaborate with: <em>Group 3 (Jiaying Chen, Yingjin He, Sabrina Seow, Kashish Solanki, Roman Vazquez Lorenzo, Maximilian Stock)</em></li>
<li>Approximately how much time did you spend on this problem set: <em>10 hours</em></li>
<li>What, if anything, gave you the most trouble: <em>Finding a way to add the legend to the election poll graph was more complicated than initally expected.</em></li>
</ul>
</div>
<div id="rubric" class="section level1">
<h1>Rubric</h1>
<p>Check minus (1/5): Displays minimal effort. Doesn’t complete all components. Code is poorly written and not documented. Uses the same type of plot for each graph, or doesn’t use plots appropriate for the variables being analyzed.</p>
<p>Check (3/5): Solid effort. Hits all the elements. No clear mistakes. Easy to follow (both the code and the output).</p>
<p>Check plus (5/5): Finished all components of the assignment correctly and addressed both challenges. Code is well-documented (both self-documented and with additional comments as necessary). Used tidyverse, instead of base R. Graphs and tables are properly labelled. Analysis is clear and easy to follow, either because graphs are labeled clearly or you’ve written additional text to describe how you interpret the output.</p>
</div>
